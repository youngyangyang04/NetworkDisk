# 上传功能使用说明

## 功能概述

本项目已实现完整的文件上传功能，包括：

- 文件拖拽上传
- 文件选择上传
- 分片上传支持
- 断点续传
- 上传进度显示
- 任务管理

## 组件结构

### 1. UploadButton 组件
- 位置：`src/components/UploadButton.vue`
- 功能：上传按钮，支持点击选择和拖拽上传
- 特性：
  - 支持多文件选择
  - 支持拖拽上传
  - 自动计算文件MD5
  - 分片上传

### 2. TaskList 组件
- 位置：`src/components/TaskList.vue`
- 功能：显示上传任务列表和进度
- 特性：
  - 实时进度显示
  - 上传速度显示
  - 剩余时间显示
  - 任务状态管理

### 3. 任务管理 Store
- 位置：`src/stores/task.js`
- 功能：管理上传任务状态
- 特性：
  - 任务添加/删除
  - 状态更新
  - 进度更新

## 使用方法

### 1. 基本使用

在页面中引入UploadButton组件：

```vue
<template>
  <div>
    <UploadButton />
    <TaskList />
  </div>
</template>

<script setup>
import UploadButton from '@/components/UploadButton.vue'
import TaskList from '@/components/TaskList.vue'
</script>
```

### 2. 上传流程

1. 点击上传按钮选择文件，或直接拖拽文件到上传区域
2. 系统自动计算文件MD5值
3. 检查文件是否已存在（秒传）
4. 如果文件不存在，开始分片上传
5. 上传完成后合并文件分片
6. 刷新文件列表

### 3. 任务管理

- 暂停/继续：可以暂停和继续上传任务
- 重试：上传失败的任务可以重试
- 取消：可以取消正在进行的任务
- 清空：清空所有已完成的任务

## 配置说明

### 上传配置

在`UploadButton.vue`中可以配置：

```javascript
const uploadConfig = {
  target: '/api/file/upload', // 上传接口
  chunkSize: 1024 * 1024,     // 分片大小（1MB）
  simultaneousUploads: 3,      // 同时上传数量
  testChunks: true,            // 是否测试分片
  preprocessFile: null,        // 文件预处理
  headers: {                   // 请求头
    'Authorization': `Bearer ${token}`
  }
}
```

### API接口

需要实现以下API接口：

1. **秒传检查**：`/api/file/secUpload`
   - 参数：filename, identifier, parentId
   - 返回：文件是否已存在

2. **分片上传**：`/api/file/upload`
   - 参数：file, chunkNumber, totalChunks, identifier等
   - 返回：上传结果

3. **合并分片**：`/api/file/mergeChunks`
   - 参数：filename, identifier, parentId, totalSize
   - 返回：合并结果

## 依赖说明

项目依赖以下第三方库：

```json
{
  "simple-uploader.js": "^0.6.0",
  "spark-md5": "^3.0.2"
}
```

- `simple-uploader.js`：提供分片上传功能
- `spark-md5`：计算文件MD5值

## 注意事项

1. **文件大小限制**：默认分片大小为1MB，可根据需要调整
2. **并发限制**：默认同时上传3个文件，避免服务器压力过大
3. **浏览器兼容性**：需要支持HTML5 File API的现代浏览器
4. **服务器配置**：需要配置足够的上传大小限制和超时时间

## 故障排除

### 常见问题

1. **上传失败**
   - 检查网络连接
   - 检查服务器配置
   - 查看浏览器控制台错误信息

2. **进度不更新**
   - 检查任务管理store是否正确更新
   - 检查组件是否正确监听状态变化

3. **文件无法选择**
   - 检查浏览器是否支持File API
   - 检查文件选择器是否正确绑定

### 调试方法

1. 打开浏览器开发者工具
2. 查看Console面板的错误信息
3. 查看Network面板的请求情况
4. 检查Vue DevTools中的组件状态

## 扩展功能

可以基于现有代码扩展以下功能：

1. **批量上传**：支持文件夹上传
2. **上传队列**：管理上传优先级
3. **断点续传**：支持网络中断后继续上传
4. **上传限速**：控制上传速度
5. **文件预览**：上传前预览文件内容
